{"version":3,"sources":["domain/Api/index.js"],"names":["buildUrl","path","get","FetchTimedOutError","Error","ApiError","response","message","statusText","status","ok","url","fetch","options","finalOptions","Object","assign","getTokenHeader","Promise","resolve","reject","onTimeout","timeout","setTimeout","then","checkResponseStatus","parseResponse","clearTimeout","catch","error","rawResponse","text","JSON","parse","e","apiResponse","not","object","keys","forEach","key","user","getState","token","access_token","headers","Accept","Authorization","undefined","Api"],"mappings":"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","file":"index.js","sourcesContent":["import isomorphicFetch from 'isomorphic-fetch';\nimport is from 'is_js';\nimport Store from 'domain/Store';\nimport camelCase from 'camelcase';\nimport Config from 'domain/Config';\n\nexport const buildUrl = (path) => Config.get('apiBase') + path;\n\nclass FetchTimedOutError extends Error { }\n\nexport class ApiError extends Error {\n  constructor(response = {}, message) {\n    super(message || response.statusText);\n    this.status = response.status;\n    this.statusText = response.statusText;\n    this.ok = response.ok;\n    this.url = response.url;\n  }\n}\n\nexport const fetch = (url, options = {}) => {\n  const finalOptions = Object.assign({}, options, getTokenHeader(options));\n  return new Promise((resolve, reject) => {\n    const onTimeout = () => reject(new FetchTimedOutError(`Call to ${url} has taken too long!`));\n    const timeout = setTimeout(onTimeout, Config.get('fetchTimeout'));\n\n    isomorphicFetch(url, finalOptions)\n      .then(checkResponseStatus)\n      .then(parseResponse)\n      .then((response) => {\n        clearTimeout(timeout);\n        resolve(response);\n      })\n      .catch((error) => {\n        clearTimeout(timeout);\n        reject(error);\n      });\n  });\n};\n\nfunction parseResponse(rawResponse) {\n  return rawResponse.text()\n      .then((response) => {\n        try {\n          return JSON.parse(response);\n        } catch (e) {\n          return response;\n        }\n      });\n}\n\nfunction checkResponseStatus(response) {\n  if (response.ok) {\n    return response;\n  }\n\n  const error = new ApiError(response);\n  try {\n    return parseResponse(response)\n        .then((apiResponse) => {\n          if (is.not.object(apiResponse)) {\n            error.response = apiResponse;\n          } else {\n            error.response = {};\n            Object.keys(apiResponse).forEach((key) => {\n              error.response[camelCase(key)] = apiResponse[key];\n            });\n          }\n\n          throw error;\n        });\n  } catch (e) {\n    throw error;\n  }\n}\n\nfunction getTokenHeader(options) {\n  const user = Store.get().getState().get('singleSignOn').user || {};\n  const token = user.access_token;\n  return {\n    headers: Object.assign(\n      {\n        Accept: 'application/json; charset=utf-8',\n        Authorization: `Bearer ${token}`,\n        'Content-Type': 'application/json; charset=utf-8',\n      },\n      is.not.object(options) ? undefined : options.headers\n    ),\n  };\n}\n\nclass Api { }\n\nApi.fetch = fetch;\nApi.buildUrl = buildUrl;\n\nexport default Api;\n"]}