{"version":3,"sources":["domain/Api/index.js"],"names":["buildUrl","path","get","FetchTimedOutError","Error","ApiError","response","message","statusText","ok","url","type","status","headers","body","fetch","options","finalOptions","Object","assign","getTokenHeader","Promise","resolve","reject","onTimeout","timeout","setTimeout","then","checkResponseStatus","parseResponse","clearTimeout","catch","error","rawResponse","text","JSON","parse","e","apiResponse","not","object","keys","forEach","key","user","getState","token","access_token","Accept","Authorization","undefined","Api"],"mappings":"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","file":"index.js","sourcesContent":["import isomorphicFetch from 'isomorphic-fetch';\nimport is from 'is_js';\nimport Store from 'domain/Store';\nimport camelCase from 'camelcase';\nimport Config from 'domain/Config';\n\nexport const buildUrl = (path) => Config.get('apiBase') + path;\n\nclass FetchTimedOutError extends Error { }\n\nexport class ApiError extends Error {\n  constructor(response = {}, message) {\n    super(message || response.statusText);\n    // https://fetch.spec.whatwg.org/#responses\n    this.ok = response.ok;\n    this.url = response.url;\n    this.type = response.type;\n    this.status = response.status;\n    this.statusText = response.statusText;\n    this.headers = response.headers;\n    this.body = response.body;\n  }\n}\n\nexport const fetch = (url, options = {}) => {\n  const finalOptions = Object.assign({}, options, getTokenHeader(options));\n  return new Promise((resolve, reject) => {\n    const onTimeout = () => reject(new FetchTimedOutError(`Call to ${url} has taken too long!`));\n    const timeout = setTimeout(onTimeout, Config.get('fetchTimeout'));\n\n    isomorphicFetch(url, finalOptions)\n      .then(checkResponseStatus)\n      .then(parseResponse)\n      .then((response) => {\n        clearTimeout(timeout);\n        resolve(response);\n      })\n      .catch((error) => {\n        clearTimeout(timeout);\n        reject(error);\n      });\n  });\n};\n\nfunction parseResponse(rawResponse) {\n  return rawResponse.text()\n      .then((response) => {\n        try {\n          return JSON.parse(response);\n        } catch (e) {\n          return response;\n        }\n      });\n}\n\nfunction checkResponseStatus(response) {\n  if (response.ok) {\n    return response;\n  }\n\n  const error = new ApiError(response);\n  try {\n    return parseResponse(response)\n        .then((apiResponse) => {\n          if (is.not.object(apiResponse)) {\n            error.response = apiResponse;\n          } else {\n            error.response = {};\n            Object.keys(apiResponse).forEach((key) => {\n              error.response[camelCase(key)] = apiResponse[key];\n            });\n          }\n\n          throw error;\n        });\n  } catch (e) {\n    throw error;\n  }\n}\n\nfunction getTokenHeader(options) {\n  const user = Store.get().getState().get('singleSignOn').user || {};\n  const token = user.access_token;\n  return {\n    headers: Object.assign(\n      {\n        Accept: 'application/json; charset=utf-8',\n        Authorization: `Bearer ${token}`,\n      },\n      is.not.object(options) ? undefined : options.headers\n    ),\n  };\n}\n\nclass Api { }\n\nApi.fetch = fetch;\nApi.buildUrl = buildUrl;\n\nexport default Api;\n"]}