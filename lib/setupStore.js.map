{"version":3,"sources":["setupStore.js"],"names":["setupStore","PRODUCTION","reducer","browserHistory","basename","reduxRouterMiddleware","createStoreWithMiddleware","getLoggerMiddleware","store","createReducer","window","devToolsExtension","syncBrowserHistory","selectLocationState","state","get","toJS","rootReducer","routing","singleSignOn","privileges","impersonate","apiCalls","fromJS","locationBeforeTransitions","action","type","merge","payload","next","debug","JSON","stringify","e","warn"],"mappings":";;;;;QAoBgBA,U,GAAAA,U;;AApBhB;;;;AACA;;;;AAEA;;;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;AAEA,IAAI,CAAEC,UAAN,EAAkB;AAChB;AACD;;AAEM,SAASD,UAAT,CAAoBE,OAApB,EAA6B;AAClC,MAAMC,iBAAiB,mCAAiB,8BAAgB,iDAAhB,CAAjB,EAA8D;AACnFC,cAAU;AADyE,GAA9D,CAAvB;;AAIA,MAAMC,wBAAwB,wCAAiBF,cAAjB,CAA9B;AACA,MAAMG,4BAA4B,oBAChC,kEAEED,qBAFF,wBAIEE,qBAJF,CADgC,qBAAlC;;AASA,MAAMC,QAAQF,0BAA0BG,cAAcP,OAAd,CAA1B,EACVQ,OAAOC,iBAAP,IAA4BD,OAAOC,iBAAP,EADlB,CAAd;;AAGA,MAAMC,qBAAqB,4CAAqBT,cAArB,EAAqCK,KAArC,EAA4C;AACrEK,yBAAqB,6BAACC,KAAD;AAAA,aAAWA,MAAMC,GAAN,CAAU,SAAV,EAAqBC,IAArB,EAAX;AAAA;AADgD,GAA5C,CAA3B;;AAIA,SAAO,EAAER,YAAF,EAASI,sCAAT,EAAP;AACD;;AAED,SAASH,aAAT,CAAuBP,OAAvB,EAAgC;AAC9B,SAAO,qCAAgB;AACrBe,iBAAa,qCAAgBf,OAAhB,CADQ;AAErBgB,oBAFqB;AAGrBC,uCAHqB;AAIrBC,mCAJqB;AAKrBC,qCALqB;AAMrBC;AANqB,GAAhB,CAAP;AAQD;;AAED,SAASJ,OAAT,GAAwF;AAAA,MAAvEJ,KAAuE,uEAA/D,oBAAUS,MAAV,CAAiB,EAAEC,2BAA2B,IAA7B,EAAjB,CAA+D;AAAA,MAARC,MAAQ;;AACtF,MAAIA,OAAOC,IAAP,sCAAJ,EAAqC;AACnC,WAAOZ,MAAMa,KAAN,CAAY;AACjBH,iCAA2BC,OAAOG;AADjB,KAAZ,CAAP;AAGD;;AAED,SAAOd,KAAP;AACD;;AAED,SAASP,mBAAT,GAA+B;AAC7B,MAAIN,UAAJ,EAAgB;AACd,WAAO;AAAA,aAAM,UAAC4B,IAAD;AAAA,eAAU,UAACJ,MAAD,EAAY;AACjC,cAAI;AACF,0BAAIK,KAAJ,CAAU,oBAAV,EAAgCC,KAAKC,SAAL,CAAeP,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAhC;AACD,WAFD,CAEE,OAAOQ,CAAP,EAAU;AACV,0BAAIC,IAAJ,CAAS,uBAAT,EAAkCD,CAAlC;AACD;;AAED,iBAAOJ,KAAKJ,MAAL,CAAP;AACD,SARY;AAAA,OAAN;AAAA,KAAP;AASD;;AAED,SAAO,gCAAP;AACD;;kBAEczB,U","file":"setupStore.js","sourcesContent":["import Immutable from 'immutable';\nimport installDevTools from 'immutable-devtools';\n\nimport thunk from 'redux-thunk';\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport { createLogger } from 'redux-logger';\nimport { createHistory, useBasename, useBeforeUnload } from 'history';\nimport { useRouterHistory } from 'react-router';\nimport { syncHistoryWithStore, routerMiddleware, LOCATION_CHANGE } from 'react-router-redux';\nimport { singleSignOnMiddleware, reducer as singleSignOn } from 'containers/SingleSignOn';\nimport { reducer as privileges } from 'containers/Privileges';\nimport { reducer as impersonate } from 'containers/Impersonate';\nimport { combineReducers } from 'redux-immutable';\nimport { reducer as apiCalls } from 'containers/ApiCalls';\nimport log from 'domain/log';\n\nif (! PRODUCTION) {\n  installDevTools(Immutable);\n}\n\nexport function setupStore(reducer) {\n  const browserHistory = useRouterHistory(useBeforeUnload(useBasename(createHistory)))({\n    basename: '',\n  });\n\n  const reduxRouterMiddleware = routerMiddleware(browserHistory);\n  const createStoreWithMiddleware = compose(\n    applyMiddleware(\n      singleSignOnMiddleware,\n      reduxRouterMiddleware,\n      thunk,\n      getLoggerMiddleware()\n    )\n  )(createStore);\n\n  const store = createStoreWithMiddleware(createReducer(reducer),\n      window.devToolsExtension && window.devToolsExtension());\n\n  const syncBrowserHistory = syncHistoryWithStore(browserHistory, store, {\n    selectLocationState: (state) => state.get('routing').toJS(),\n  });\n\n  return { store, syncBrowserHistory };\n}\n\nfunction createReducer(reducer) {\n  return combineReducers({\n    rootReducer: combineReducers(reducer),\n    routing,\n    singleSignOn,\n    privileges,\n    impersonate,\n    apiCalls,\n  });\n}\n\nfunction routing(state = Immutable.fromJS({ locationBeforeTransitions: null }), action) {\n  if (action.type === LOCATION_CHANGE) {\n    return state.merge({\n      locationBeforeTransitions: action.payload,\n    });\n  }\n\n  return state;\n}\n\nfunction getLoggerMiddleware() {\n  if (PRODUCTION) {\n    return () => (next) => (action) => {\n      try {\n        log.debug('Dispatched action:', JSON.stringify(action, null, 2));\n      } catch (e) {\n        log.warn('Could not log action:', e);\n      }\n\n      return next(action);\n    };\n  }\n\n  return createLogger();\n}\n\nexport default setupStore;\n"]}