{"version":3,"sources":["setupStore.js"],"names":["setupStore","PRODUCTION","reducer","browserHistory","basename","notificationsTriggerConfig","get","reduxRouterMiddleware","createStoreWithMiddleware","apply","undefined","filter","i","store","createReducer","window","devToolsExtension","syncBrowserHistory","selectLocationState","state","toJS","rootReducer","routing","singleSignOn","privileges","impersonate","apiCalls","fromJS","locationBeforeTransitions","action","type","merge","payload"],"mappings":";;;;;QAsBgBA,U,GAAAA,U;;AAtBhB;;;;AACA;;;;AAEA;;;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAI,CAAEC,UAAN,EAAkB;AAChB;AACD;;AAEM,SAASD,UAAT,CAAoBE,OAApB,EAA6B;AAClC,MAAMC,iBAAiB,mCAAiB,8BAAgB,iDAAhB,CAAjB,EAA8D;AACnFC,cAAU;AADyE,GAA9D,CAAvB;;AAIA,MAAMC,6BAA6B,iBAAOC,GAAP,CAAW,sBAAX,CAAnC;;AAEA,MAAMC,wBAAwB,wCAAiBJ,cAAjB,CAA9B;AACA,MAAMK,4BAA4B,oBAChC,uBAAgBC,KAAhB,CAAsB,IAAtB,EAA4B,CAC1BF,qBAD0B,wBAG1B,oDAH0B,EAI1B,uCAJ0B,EAK1BF,6BACI,6CAA8BA,0BAA9B,CADJ,GAEIK,SAPsB,EAQ1BC,MAR0B,CAQnB,UAACC,CAAD;AAAA,WAAOA,CAAP;AAAA,GARmB,CAA5B,CADgC,qBAAlC;;AAYA,MAAMC,QAAQL,0BAA0BM,cAAcZ,OAAd,CAA1B,EACVa,OAAOC,iBAAP,IAA4BD,OAAOC,iBAAP,EADlB,CAAd;;AAGA,MAAMC,qBAAqB,4CAAqBd,cAArB,EAAqCU,KAArC,EAA4C;AACrEK,yBAAqB,6BAACC,KAAD;AAAA,aAAWA,MAAMb,GAAN,CAAU,SAAV,EAAqBc,IAArB,EAAX;AAAA;AADgD,GAA5C,CAA3B;;AAIA,MAAI,iBAAOd,GAAP,CAAW,cAAX,CAAJ,EAAgC;AAC9B,gCAASO,KAAT,EAAgB,sCAAhB;AACD;;AAED,SAAO,EAAEA,YAAF,EAASI,sCAAT,EAAP;AACD;;AAED,SAASH,aAAT,CAAuBZ,OAAvB,EAAgC;AAC9B,SAAO,qCAAgB;AACrBmB,iBAAa,qCAAgBnB,OAAhB,CADQ;AAErBoB,oBAFqB;AAGrBC,uCAHqB;AAIrBC,mCAJqB;AAKrBC,qCALqB;AAMrBC;AANqB,GAAhB,CAAP;AAQD;;AAED,SAASJ,OAAT,GAAwF;AAAA,MAAvEH,KAAuE,uEAA/D,oBAAUQ,MAAV,CAAiB,EAAEC,2BAA2B,IAA7B,EAAjB,CAA+D;AAAA,MAARC,MAAQ;;AACtF,MAAIA,OAAOC,IAAP,sCAAJ,EAAqC;AACnC,WAAOX,MAAMY,KAAN,CAAY;AACjBH,iCAA2BC,OAAOG;AADjB,KAAZ,CAAP;AAGD;;AAED,SAAOb,KAAP;AACD;;kBAEcnB,U","file":"setupStore.js","sourcesContent":["import Immutable from 'immutable';\nimport installDevTools from 'immutable-devtools';\n\nimport thunk from 'redux-thunk';\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport { combineReducers } from 'redux-immutable';\nimport { useRouterHistory } from 'react-router';\nimport { createHistory, useBasename, useBeforeUnload } from 'history';\nimport { syncHistoryWithStore, routerMiddleware, LOCATION_CHANGE } from 'react-router-redux';\nimport { createUserManager, loadUser, reducer as oidcStateReducer } from 'data/SingleSignOn';\nimport { reducer as privileges } from 'containers/Privileges';\nimport { reducer as impersonate } from 'containers/Impersonate';\nimport { reducer as apiCalls } from 'containers/ApiCalls';\nimport { createSignInRedirectMiddleware } from 'containers/SingleSignOn';\nimport createLoggerMiddleware from 'domain/createLoggerMiddleware';\nimport createNotificationsMiddleware from 'domain/createNotificationsMiddleware';\nimport Config from 'domain/Config';\n\nif (! PRODUCTION) {\n  installDevTools(Immutable);\n}\n\nexport function setupStore(reducer) {\n  const browserHistory = useRouterHistory(useBeforeUnload(useBasename(createHistory)))({\n    basename: '',\n  });\n\n  const notificationsTriggerConfig = Config.get('notificationsTrigger');\n\n  const reduxRouterMiddleware = routerMiddleware(browserHistory);\n  const createStoreWithMiddleware = compose(\n    applyMiddleware.apply(this, [\n      reduxRouterMiddleware,\n      thunk,\n      createSignInRedirectMiddleware(),\n      createLoggerMiddleware(),\n      notificationsTriggerConfig ?\n          createNotificationsMiddleware(notificationsTriggerConfig) :\n          undefined,\n    ].filter((i) => i))\n  )(createStore);\n\n  const store = createStoreWithMiddleware(createReducer(reducer),\n      window.devToolsExtension && window.devToolsExtension());\n\n  const syncBrowserHistory = syncHistoryWithStore(browserHistory, store, {\n    selectLocationState: (state) => state.get('routing').toJS(),\n  });\n\n  if (Config.get('featureLogin')) {\n    loadUser(store, createUserManager());\n  }\n\n  return { store, syncBrowserHistory };\n}\n\nfunction createReducer(reducer) {\n  return combineReducers({\n    rootReducer: combineReducers(reducer),\n    routing,\n    singleSignOn: oidcStateReducer,\n    privileges,\n    impersonate,\n    apiCalls,\n  });\n}\n\nfunction routing(state = Immutable.fromJS({ locationBeforeTransitions: null }), action) {\n  if (action.type === LOCATION_CHANGE) {\n    return state.merge({\n      locationBeforeTransitions: action.payload,\n    });\n  }\n\n  return state;\n}\n\nexport default setupStore;\n"]}