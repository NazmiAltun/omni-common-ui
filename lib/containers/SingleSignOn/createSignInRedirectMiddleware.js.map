{"version":3,"sources":["containers/SingleSignOn/createSignInRedirectMiddleware.js"],"names":["createSignInRedirectMiddleware","next","action","type","location","pathname","info","sessionStorage","lastUrlPath","search","signInRedirectWithValidation","returnUrl","forceSignOutRedirect"],"mappings":";;;;;QAUgBA,8B,GAAAA,8B;;AAVhB;;;;AACA;;AAOA;;;;AAEO,SAASA,8BAAT,GAA0C;AAC/C,SAAO;AAAA,WAAM,UAACC,IAAD;AAAA,aAAU,UAACC,MAAD,EAAY;AACjC,gBAAQA,OAAOC,IAAf;AACE;AACA;AACA;AACA;AACE,gBAAIC,SAASC,QAAT,KAAsB,WAA1B,EAAuC,MADzC,CACiD;AAC/C,0BAAIC,IAAJ,CAAS,qFAAT;AACAC,2BAAeC,WAAf,GACIJ,SAASC,QAAT,GAAoBD,SAASK,MADjC;AAEA,mDAAoBC,4BAApB;AACA;AACF;AACEH,2BAAeC,WAAf,GACIN,OAAOS,SAAP,IAAoBP,SAASC,QAAT,GAAoBD,SAASK,MADrD;AAEA,mDAAoBG,oBAApB;AACA;AACF;AAAS;AAhBX;AAkBA,eAAOX,KAAKC,MAAL,CAAP;AACD,OApBY;AAAA,KAAN;AAAA,GAAP;AAqBD;;kBAEcF,8B","file":"createSignInRedirectMiddleware.js","sourcesContent":["import log from 'domain/log';\nimport {\n  USER_EXPIRED,\n  USER_NOT_FOUND,\n  LOAD_USER_ERROR,\n  SESSION_TERMINATED,\n  TRIGGER_SIGNOUT_REDIRECT,\n} from 'data/SingleSignOn/actions';\nimport { createUserManager } from 'data/SingleSignOn';\n\nexport function createSignInRedirectMiddleware() {\n  return () => (next) => (action) => {\n    switch (action.type) {\n      case USER_EXPIRED:\n      case USER_NOT_FOUND:\n      case LOAD_USER_ERROR:\n      case SESSION_TERMINATED:\n        if (location.pathname === '/callback') break;  // still processing the callback\n        log.info('createSignInRedirectMiddleware: Caught an invalid user/session action. Redirecting.');\n        sessionStorage.lastUrlPath =\n            location.pathname + location.search;\n        createUserManager().signInRedirectWithValidation();\n        break;\n      case TRIGGER_SIGNOUT_REDIRECT:\n        sessionStorage.lastUrlPath =\n            action.returnUrl || location.pathname + location.search;\n        createUserManager().forceSignOutRedirect();\n        break;\n      default: break;\n    }\n    return next(action);\n  };\n}\n\nexport default createSignInRedirectMiddleware;\n"]}