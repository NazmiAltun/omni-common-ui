{"version":3,"sources":["containers/SingleSignOn/createSignInRedirectMiddleware.js"],"names":["createSignInRedirectMiddleware","store","next","action","type","location","pathname","info","sessionStorage","lastUrlPath","returnUrl","search","signInRedirectWithValidation","dispatch","forceSignOutRedirect"],"mappings":";;;;;QAagBA,8B,GAAAA,8B;;AAbhB;;;;AACA;;AAUA;;;;AAEO,SAASA,8BAAT,GAA0C;AAC/C,SAAO,UAACC,KAAD;AAAA,WAAW,UAACC,IAAD;AAAA,aAAU,UAACC,MAAD,EAAY;AACtC,gBAAQA,OAAOC,IAAf;AACE;AACA;AACA;AACA;AACE,gBAAIC,SAASC,QAAT,KAAsB,WAA1B,EAAuC,MADzC,CACiD;AAC/C,0BAAIC,IAAJ,CAAS,qFAAT;AACA;AACF;AAA+B;AAC7BC,2BAAeC,WAAf,GACIN,OAAOO,SAAP,IAAoBL,SAASC,QAAT,GAAoBD,SAASM,MADrD;AAEA,mDAAoBC,4BAApB;AACA;AACA,gBAAIT,OAAOC,IAAP,qCAAJ,EAA6C;AAC3CH,oBAAMY,QAAN,CAAe,EAAET,iCAAF,EAAf;AACD;AACD;AACF;AACA;AACEI,2BAAeC,WAAf,GACIN,OAAOO,SAAP,IAAoBL,SAASC,QAAT,GAAoBD,SAASM,MADrD;AAEA,mDAAoBG,oBAApB;AACA;AACF;AAAS;AAvBX;AAyBA,eAAOZ,KAAKC,MAAL,CAAP;AACD,OA3BiB;AAAA,KAAX;AAAA,GAAP;AA4BD;;kBAEcH,8B","file":"createSignInRedirectMiddleware.js","sourcesContent":["import log from 'domain/log';\nimport {\n  LOAD_USER_ERROR,\n  USER_EXPIRED,\n  USER_NOT_FOUND,\n  USER_SIGNED_OUT,\n  SESSION_TERMINATED,\n  TRIGGER_USER_CLEAR,\n  TRIGGER_SIGNIN_REDIRECT,\n  TRIGGER_SIGNOUT_REDIRECT,\n} from 'data/SingleSignOn/actions';\nimport { createUserManager } from 'data/SingleSignOn';\n\nexport function createSignInRedirectMiddleware() {\n  return (store) => (next) => (action) => {\n    switch (action.type) {\n      case LOAD_USER_ERROR:\n      case USER_EXPIRED:\n      case USER_NOT_FOUND:\n      case SESSION_TERMINATED:\n        if (location.pathname === '/callback') break;  // still processing the callback\n        log.info('createSignInRedirectMiddleware: Caught an invalid user/session action. Redirecting.');\n        // intentionally fall through to the next case!\n      case TRIGGER_SIGNIN_REDIRECT:  // eslint-disable-line\n        sessionStorage.lastUrlPath =\n            action.returnUrl || location.pathname + location.search;\n        createUserManager().signInRedirectWithValidation();\n        // for impersonate mode, prevents an infinite loop\n        if (action.type === TRIGGER_SIGNIN_REDIRECT) {\n          store.dispatch({ type: TRIGGER_USER_CLEAR });\n        }\n        break;\n      case USER_SIGNED_OUT:\n      case TRIGGER_SIGNOUT_REDIRECT:\n        sessionStorage.lastUrlPath =\n            action.returnUrl || location.pathname + location.search;\n        createUserManager().forceSignOutRedirect();\n        break;\n      default: break;\n    }\n    return next(action);\n  };\n}\n\nexport default createSignInRedirectMiddleware;\n"]}