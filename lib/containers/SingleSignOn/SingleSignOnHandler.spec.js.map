{"version":3,"sources":["containers/SingleSignOn/SingleSignOnHandler.spec.jsx"],"names":["describe","SingleSignOnHandler","props","signinRedirect","requireComponent","Config","require","merge","mountComponent","beforeEach","stub","returns","featureLogin","fetchPrivilegesIfNeeded","spy","user","expired","profile","sub","afterEach","restore","context","it","called","to","be","false","wrapper","have","descendants","true","not"],"mappings":"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","file":"SingleSignOnHandler.spec.js","sourcesContent":["import React from 'react';\nimport Sinon from 'sinon';\nimport { expect } from 'chai';\nimport { mount } from 'enzyme';\nimport userManager from './userManager';\nimport _Config from 'domain/Config';\n\ndescribe('<SingleSignOnHandler />', () => {\n  let SingleSignOnHandler;\n  let props;\n  let signinRedirect;\n\n  // eslint-disable-next-line import/no-webpack-loader-syntax, global-require\n  const requireComponent = (Config) => require('inject?domain/Config&./userManager!./SingleSignOnHandler')({\n    'domain/Config': _Config.merge(Config),\n    './userManager': userManager,\n  }).SingleSignOnHandler;\n\n  const mountComponent = () => mount(<SingleSignOnHandler {...props}>\n    <div id=\"inner\" />\n  </SingleSignOnHandler>);\n\n  beforeEach(() => {\n    signinRedirect = Sinon.stub(userManager, 'signinRedirectWithValidation');\n    signinRedirect.returns();\n    SingleSignOnHandler = requireComponent({ featureLogin: false });\n    props = {\n      fetchPrivilegesIfNeeded: Sinon.spy(),\n      user: {\n        expired: false,\n        profile: {\n          sub: '123',\n        },\n      },\n    };\n  });\n\n  afterEach(() => {\n    signinRedirect.restore();\n  });\n\n  context('when featureLogin is false', () => {\n    it('does not call userManager.signinRedirect() even if the user is not valid', () => {\n      props.user = null;\n      mountComponent();\n      expect(signinRedirect.called).to.be.false;\n    });\n\n    it('does not call userManager.signinRedirect() even if the user is expired', () => {\n      props.user.expired = true;\n      mountComponent();\n      expect(signinRedirect.called).to.be.false;\n    });\n\n    it('does not call fetchPrivilegesIfNeeded even if the user is fine', () => {\n      mountComponent();\n      expect(props.fetchPrivilegesIfNeeded.called).to.be.false;\n    });\n\n    it('renders its children if the user is fine', () => {\n      const wrapper = mountComponent();\n      expect(wrapper).to.have.descendants('#inner');\n    });\n\n    it('renders its children even if the user is not valid', () => {\n      props.user = null;\n      const wrapper = mountComponent();\n      expect(wrapper).to.have.descendants('#inner');\n    });\n  });\n\n  context('when featureLogin is true', () => {\n    beforeEach(() => {\n      SingleSignOnHandler = requireComponent({ featureLogin: true });\n    });\n\n    it('calls userManager.signinRedirect() if the user is not valid', () => {\n      props.user = null;\n      mountComponent();\n      expect(signinRedirect.called).to.be.true;\n    });\n\n    it('calls userManager.signinRedirect() if the user is expired', () => {\n      props.user.expired = true;\n      mountComponent();\n      expect(signinRedirect.called).to.be.true;\n    });\n\n    it('calls fetchPrivilegesIfNeeded if the user is fine', () => {\n      mountComponent();\n      expect(props.fetchPrivilegesIfNeeded.called).to.be.true;\n    });\n\n    it('renders its children if the user is fine', () => {\n      const wrapper = mountComponent();\n      expect(wrapper).to.have.descendants('#inner');\n    });\n\n    it('does not render its children if the user is not valid', () => {\n      props.user = null;\n      const wrapper = mountComponent();\n      expect(wrapper).to.not.have.descendants('#inner');\n    });\n  });\n});\n"]}