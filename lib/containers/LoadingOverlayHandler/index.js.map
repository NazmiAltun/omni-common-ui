{"version":3,"sources":["containers/LoadingOverlayHandler/index.jsx"],"names":["HTTP_METHOD_TRIGGERS","REQUEST_DURATION_THRESHOLD_MS","IS_ACTIVE","get","LoadingOverlayHandler","state","isThrobberVisible","_updateState","nextProps","props","isAnyApiCallLoadingBeyondThreshold","isAnyApiCallLoading","setState","clearTimeout","timer","setTimeout","loadingApiCalls","getIsAnyApiCallLoadingBeyondThreshold","children","classes","pace","innerClassName","propTypes","shape","filter","func","bool","isRequired","node","mapStateToProps","getLoadingApiCalls","Boolean","call","key","startsWith","State","isLoading","disableDefault","object","size","apiCalls","Date","getTime","timestamp","find"],"mappings":"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","file":"index.js","sourcesContent":["import styles from './style.postcss';\n\nimport React, { PureComponent } from 'react';\nimport classnames from 'classnames';\nimport is from 'is_js';\n\nimport connect from 'domain/connect';\nimport ApiCall from 'containers/ApiCalls';\nimport Config from 'domain/Config';\nimport PropTypes from 'prop-types';\nimport testClass from 'domain/testClass';\n\nconst HTTP_METHOD_TRIGGERS = 'GET';\nconst REQUEST_DURATION_THRESHOLD_MS = 100;\n\n// config feature flag\nconst IS_ACTIVE = !! Config.get('showLoadingOverlayForApiGets');\n\nclass LoadingOverlayHandler extends PureComponent {\n  constructor() {\n    super();\n    this.state = { isThrobberVisible: false };\n  }\n\n  componentDidMount() {\n    this._updateState();\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this._updateState(nextProps);\n  }\n\n  _updateState(props = this.props) {\n    const { isAnyApiCallLoadingBeyondThreshold, isAnyApiCallLoading } = props;\n    if (! IS_ACTIVE) return; // CONFIG flag check\n    if (isAnyApiCallLoadingBeyondThreshold) {\n      this.setState({ isThrobberVisible: true });\n    } else if (isAnyApiCallLoading) {\n      clearTimeout(this.timer);\n      this.timer = setTimeout(() => {\n        const { loadingApiCalls } = this.props;\n        if (! getIsAnyApiCallLoadingBeyondThreshold(loadingApiCalls)) return;\n        this.setState({ isThrobberVisible: true });\n      }, REQUEST_DURATION_THRESHOLD_MS);\n    } else if (! isAnyApiCallLoading) {\n      clearTimeout(this.timer);\n      this.setState({ isThrobberVisible: false });\n    }\n  }\n\n  render() {\n    const { children } = this.props;\n    const classes = classnames({\n      pace: true,\n      'pace-inactive': ! this.state.isThrobberVisible,\n      'pace-active': this.state.isThrobberVisible,\n    });\n    const innerClassName = classnames('pace-activity',\n      {\n        [testClass('is-any-api-call-loading')]: this.props.isAnyApiCallLoading,\n      });\n    return <div className={styles.LoadingOverlayHandler}>\n      <div className={classes}>\n        <div className={innerClassName} />\n      </div>\n      {children}\n    </div>;\n  }\n}\n\nLoadingOverlayHandler.propTypes = {\n  loadingApiCalls: PropTypes.shape({\n    filter: PropTypes.func,\n  }),\n  isAnyApiCallLoading: PropTypes.bool.isRequired,\n  isAnyApiCallLoadingBeyondThreshold: PropTypes.bool.isRequired,\n  children: PropTypes.node.isRequired,\n};\n\nfunction mapStateToProps(state) {\n  const loadingApiCalls = getLoadingApiCalls(state);\n  const isAnyApiCallLoadingBeyondThreshold =\n      Boolean(loadingApiCalls && getIsAnyApiCallLoadingBeyondThreshold(loadingApiCalls));\n  return {\n    loadingApiCalls,\n    isAnyApiCallLoading: !! loadingApiCalls,\n    isAnyApiCallLoadingBeyondThreshold,\n  };\n}\n\nfunction getLoadingApiCalls(state) {\n  const loadingApiCalls = state.get('apiCalls')\n    .filter((call, key) => key.startsWith(HTTP_METHOD_TRIGGERS))\n    .filter((call) => ApiCall.State.isLoading(call))\n    .filter((call) => ! call.disableDefault);\n  if (is.object(loadingApiCalls) && loadingApiCalls.size) {\n    return loadingApiCalls;\n  }\n  return null;\n}\n\nfunction getIsAnyApiCallLoadingBeyondThreshold(apiCalls) {\n  if (! apiCalls) return false;\n  return !! apiCalls.filter((call) =>\n      new Date().getTime() - call.timestamp.getTime() >= REQUEST_DURATION_THRESHOLD_MS)\n    .find(() => true);\n}\n\nexport default connect(mapStateToProps)(LoadingOverlayHandler);\n"]}