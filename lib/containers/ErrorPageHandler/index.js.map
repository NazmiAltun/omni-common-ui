{"version":3,"sources":["containers/ErrorPageHandler/index.jsx"],"names":["mapStateToProps","ErrorPageHandler","props","children","config","erroredApis","erroredApi","clean","cleanErrors","forEach","api","id","renderError","renderChildren","error","status","setLastUrlPath","forceSignoutRedirect","Error","shouldShowPopUp","response","buildMessage","sessionStorage","lastUrlPath","location","pathname","search","get","object","message","for","errorCode","not","array","args","arg","replace","propTypes","node","func","isRequired","state","routes","getApiErrors","getApiError","mapDispatchToProps","dispatch","key","getErrors","toList","size","undefined","first"],"mappings":"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","file":"index.js","sourcesContent":["import styles from './style.postcss';\nimport React from 'react';\nimport pure from 'recompose/pure';\nimport ErrorPage from 'components/ErrorPage';\nimport connect from 'domain/connect';\nimport ApiCall from 'containers/ApiCalls';\nimport ErrorPageConfig from 'domain/ErrorPageConfig';\nimport is from 'is_js';\nimport AlertDialog from 'components/AlertDialog';\nimport ErrorMessage from 'domain/ErrorMessage';\nimport Config from 'domain/Config';\nimport userManager from 'containers/SingleSignOn/userManager';\nimport PropTypes from 'prop-types';\n\nexport const ErrorPageHandler = (props) => {\n  const { children, config, erroredApis, erroredApi, clean } = props;\n  const cleanErrors = () => erroredApis.forEach((api) => clean(api.id));\n\n  return <div className={styles.ErrorPageHandler}>\n    {renderError()}\n    {renderChildren()}\n  </div>;\n\n  function renderError() {\n    if (! erroredApi) {\n      return null;\n    }\n\n    if (erroredApi.error && erroredApi.error.status === 401) {\n      setLastUrlPath();\n      userManager.forceSignoutRedirect();\n      throw new Error('Api called with 401 unauthorized');\n    }\n\n    if (shouldShowPopUp()) {\n      const { response } = erroredApi.error;\n      return <AlertDialog isWarning\n          content1={buildMessage(response)}\n          okButtonContent=\"OK\"\n          onButtonClick={cleanErrors} />;\n    }\n\n    return <ErrorPage erroredApi={erroredApi}\n        config={config}\n        afterButtonClicked={cleanErrors}\n        {...props} />;\n  }\n\n  function setLastUrlPath() {\n    sessionStorage.lastUrlPath = location.pathname + location.search;\n  }\n\n  function renderChildren() {\n    if (erroredApi && ! shouldShowPopUp()) {\n      return null; // Because the error page will be rendered.\n    }\n\n    return children;\n  }\n\n  function shouldShowPopUp() {\n    if (Config.get('errorHandlerRendersPopUps') !== true || ! erroredApi) {\n      return false;\n    }\n\n    const { response, status } = erroredApi.error;\n    return is.object(response) && status !== 500;\n  }\n\n  function buildMessage(response) {\n    let message = ErrorMessage.for(response.errorCode) || response.message;\n\n    // To handle the pattern of exception response from the end point of identity server\n    // which return { error: string }\n    if (! message && response.error) {\n      message = response.error;\n      return message;\n    }\n\n    if (is.not.array(response.args)) {\n      return message;\n    }\n\n    response.args.forEach((arg) => {\n      message = message.replace(/{\".*\"}/i, arg);\n    });\n\n    return message;\n  }\n};\n\nErrorPageHandler.propTypes = {\n  children: PropTypes.node,\n  replace: PropTypes.func.isRequired,\n  clean: PropTypes.func.isRequired,\n  erroredApis: PropTypes.object,\n  erroredApi: PropTypes.object,\n  config: PropTypes.object,\n};\n\nexport function mapStateToProps(state, { routes }) {\n  const erroredApis = getApiErrors(state);\n  const erroredApi = getApiError(erroredApis);\n  return { erroredApis, erroredApi, config: ErrorPageConfig.get(routes) };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return { clean: (key) => dispatch(ApiCall.clean(key)) };\n}\n\nfunction getApiErrors(state) {\n  return ApiCall.getErrors(state).toList();\n}\n\nfunction getApiError(erroredApis) {\n  if (erroredApis.size <= 0) {\n    return undefined;\n  }\n\n  return erroredApis.first();\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(pure(ErrorPageHandler));\n"]}