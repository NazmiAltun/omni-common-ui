{"version":3,"sources":["containers/ErrorPageHandler/spec.jsx"],"names":["ErrorPage","requireComponent","Config","require","merge","getComponent","ErrorPageHandler","getMapStateToProps","mapStateToProps","describe","props","buildProps","response","error","not","undefined","erroredApi","State","createFailed","erroredApis","Error","clean","spy","beforeEach","it","wrapper","to","have","descendants","afterButtonClicked","find","prop","args","eql","context","errorHandlerRendersPopUps","status","state","ownProps","buildState","apiCalls","createLoading","routes","errorPage","isList","equal","isEmpty","config","be","failedCall1","failedCall2","get","disableDefault","size"],"mappings":"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","file":"spec.js","sourcesContent":["import React from 'react';\nimport { expect } from 'chai';\nimport { mount } from 'enzyme';\nimport ApiCall from 'containers/ApiCalls';\nimport { Map, List } from 'immutable';\nimport Sinon from 'sinon';\nimport AlertDialog from 'components/AlertDialog';\nimport _Config from 'domain/Config';\nimport { ApiError } from 'domain/Api';\nimport is from 'is_js';\n\nconst ErrorPage = () => null;\n// eslint-disable-next-line import/no-webpack-loader-syntax, global-require\nconst requireComponent = (Config) => require('inject-loader?components/ErrorPage&domain/Config!./')({\n  'components/ErrorPage': ErrorPage,\n  'domain/Config': _Config.merge(Config),\n});\n\nconst getComponent = (Config) => requireComponent(Config).ErrorPageHandler;\nconst getMapStateToProps = (Config) => requireComponent(Config).mapStateToProps;\n\ndescribe('<ErrorPageHandler />', () => {\n  describe('component', () => {\n    let props;\n    let ErrorPageHandler;\n\n    const buildProps = (response = {}) => {\n      const error = new ApiError(response);\n      if (is.not.undefined(response.response)) {\n        error.response = response.response;\n      }\n\n      const erroredApi = ApiCall.State.createFailed('id1', error);\n      return {\n        erroredApis: new List([\n          erroredApi,\n          ApiCall.State.createFailed('id2', new Error()),\n        ]),\n        erroredApi,\n        clean: Sinon.spy(),\n      };\n    };\n\n    beforeEach(() => {\n      props = buildProps();\n      ErrorPageHandler = getComponent();\n    });\n\n    it('renders its children if no failed ApiCall.State is received as erroredApi', () => {\n      props.erroredApis = new List();\n      props.erroredApi = undefined;\n      const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n      expect(wrapper).to.have.descendants('#inner');\n    });\n\n    it('renders the error page if a failed ApiCall.State is received as erroredApi and has no response', () => {\n      const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n      expect(wrapper).to.have.descendants(ErrorPage);\n      expect(wrapper).to.not.have.descendants('#inner');\n    });\n\n    it('calls clean() for all the failed API calls received', () => {\n      const wrapper = mount(<ErrorPageHandler {...props} />);\n      const afterButtonClicked = wrapper.find(ErrorPage).prop('afterButtonClicked');\n      afterButtonClicked();\n      expect(props.clean.args).to.eql([['id1'], ['id2']]);\n    });\n\n    context('when errorHandlerRendersPopUps config option is true', () => {\n      beforeEach(() => {\n        ErrorPageHandler = getComponent(Map({ errorHandlerRendersPopUps: true }));\n      });\n\n      it('renders the error page if a failed ApiCall.State is received as erroredApi and its code is 500', () => {\n        props = buildProps({ status: 500 });\n        const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n        expect(wrapper).to.have.descendants(ErrorPage);\n        expect(wrapper).to.not.have.descendants('#inner');\n      });\n\n      it('renders the error dialog if a failed ApiCall.State is received as erroredApi ' +\n          'and its code is not 500 and there is an object in the response property', () => {\n        props = buildProps({ status: 400, response: {} });\n        const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n        expect(wrapper).to.have.descendants(AlertDialog);\n        expect(wrapper).to.have.descendants('#inner');\n      });\n\n      it('does not the error dialog if a failed ApiCall.State is received as erroredApi ' +\n          'and its code is not 500 but there is not an object in the response property', () => {\n        props = buildProps({ status: 400, response: 'Some string' });\n        const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n        expect(wrapper).to.have.descendants(ErrorPage);\n        expect(wrapper).to.not.have.descendants('#inner');\n      });\n    });\n\n    context('when errorHandlerRendersPopUps config option is not true', () => {\n      beforeEach(() => {\n        ErrorPageHandler = getComponent(Map({ errorHandlerRendersPopUps: false }));\n      });\n\n      it('renders the error page if a failed ApiCall.State is received as erroredApi and its code is 500', () => {\n        props = buildProps({ status: 500 });\n        const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n        expect(wrapper).to.have.descendants(ErrorPage);\n        expect(wrapper).to.not.have.descendants('#inner');\n      });\n\n      it('renders the error page if a failed ApiCall.State is received as erroredApi and its code is not 500', () => {\n        props = buildProps({ status: 400 });\n        const wrapper = mount(<ErrorPageHandler {...props}><div id=\"inner\" /></ErrorPageHandler>);\n        expect(wrapper).to.have.descendants(ErrorPage);\n        expect(wrapper).to.not.have.descendants('#inner');\n      });\n    });\n  });\n\n  describe('mapStateToProps', () => {\n    let state;\n    let ownProps;\n    let mapStateToProps;\n\n    const buildState = (apiCalls = {}) => new Map({\n      apiCalls: new Map({\n        'GET /some/path': ApiCall.State.createLoading(),\n      }).merge(apiCalls),\n    });\n\n    beforeEach(() => {\n      state = buildState();\n      mapStateToProps = getMapStateToProps();\n      ownProps = {\n        routes: [\n          {},\n          { errorPage: {} },\n          { errorPage: {} },\n        ],\n      };\n    });\n\n    it('returns erroredApis as empty List if no API has failed', () => {\n      const { erroredApis } = mapStateToProps(state, ownProps);\n      expect(List.isList(erroredApis)).to.equal(true, 'is a List');\n      expect(erroredApis.isEmpty()).to.equal(true, 'is empty');\n    });\n\n    it('returns config as undefined if no route has an errorPage property', () => {\n      ownProps.routes = [{}, {}, {}];\n      expect(mapStateToProps(state, ownProps).config).to.be.undefined;\n    });\n\n    it('returns errorPage in the last route with an errorPage property as config', () => {\n      expect(mapStateToProps(state, ownProps).config).to.equal(ownProps.routes[2].errorPage);\n    });\n\n    it('returns erroredApis with failing a list of ApiCall.State ' +\n        'if they exist in the state', () => {\n      const failedCall1 = ApiCall.State.createFailed('GET /my/path', new Error());\n      const failedCall2 = ApiCall.State.createFailed('GET /my/path/2', new Error());\n      state = buildState({\n        'GET /my/path': failedCall1,\n        'GET /my/path/2': failedCall2,\n      });\n      expect(mapStateToProps(state, ownProps).erroredApis.get(0)).to.equal(failedCall1);\n      expect(mapStateToProps(state, ownProps).erroredApis.get(1)).to.equal(failedCall2);\n    });\n\n    it('ignores errores APIs if disableDefault=true for them', () => {\n      const failedCall1 = ApiCall.State.createFailed('GET /my/path', new Error());\n      const failedCall2 = ApiCall.State.createFailed('GET /my/path/2', new Error(), { disableDefault: true });\n      state = buildState({\n        'GET /my/path': failedCall1,\n        'GET /my/path/2': failedCall2,\n      });\n      const { erroredApis } = mapStateToProps(state, ownProps);\n      expect(erroredApis.size).to.equal(1);\n      expect(erroredApis.get(0)).to.equal(failedCall1);\n    });\n  });\n});\n"]}