{"version":3,"sources":["components/Callout/index.jsx"],"names":["RESIZE_DEBOUNCE_MS","Callout","state","open","_onClick","bind","_onClickedOutside","_updatePosition","document","body","addEventListener","window","_onResizeHandler","leading","trailing","removeEventListener","_calloutNode","props","points","offset","notchPoints","_notchNode","_node","children","evt","contains","target","onOpenStateChanged","setState","newOpen","popupClassName","content","newContent","cloneElement","className","Callout_popup","ref","node","key","Callout_trigger","Callout_notch","defaultProps","propTypes","string","arrayOf","val","length","Error","number","func"],"mappings":"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","file":"index.js","sourcesContent":["import styles from './style.postcss';\n\nimport React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport is from 'is_js';\nimport domAlign from 'dom-align';\nimport debounce from 'lodash.debounce';\nimport classnames from 'classnames';\nimport { CSSTransitionGroup } from 'react-transition-group';\n\nconst RESIZE_DEBOUNCE_MS = 30;\n\nclass Callout extends PureComponent {\n  constructor() {\n    super();\n    this.state = { open: false };\n    this._onClick = this._onClick.bind(this);\n    this._onClickedOutside = this._onClickedOutside.bind(this);\n  }\n\n  componentDidMount() {\n    this._updatePosition();\n    document.body.addEventListener('click', this._onClickedOutside);\n    document.body.addEventListener('touchstart', this._onClickedOutside);\n    window.addEventListener('resize', this._onResizeHandler = debounce(() => {\n      this._updatePosition();\n    }, RESIZE_DEBOUNCE_MS, {\n      leading: true,  // nicer iOS screen rotate\n      trailing: true,\n    }), false);\n  }\n\n  componentDidUpdate() {\n    this._updatePosition();\n  }\n\n  componentWillUnmount() {\n    document.body.removeEventListener('click', this._onClickedOutside);\n    document.body.removeEventListener('touchstart', this._onClickedOutside);\n    window.removeEventListener('resize', this._onResizeHandler);\n  }\n\n  _updatePosition() {\n    if (! this._calloutNode) return;\n    const { points, offset } = this.props;\n    const notchPoints = ['tl', 'bl'];\n    domAlign(this._notchNode, this._node.children[0], {\n      points: notchPoints,\n      offset: [0, 15],\n    });\n    domAlign(this._calloutNode, this._node.children[0], {\n      points, offset });\n  }\n\n  _onClickedOutside(evt) {\n    if ((this._node && this._node.contains(evt.target)) ||\n        (this._calloutNode && this._calloutNode.contains(evt.target))) {\n      return;\n    }\n    const { onOpenStateChanged } = this.props;\n    this.setState({ open: false }, () => {\n      onOpenStateChanged && onOpenStateChanged(false);\n    });\n  }\n\n  _onClick() {\n    const newOpen = ! this.state.open;\n    const { onOpenStateChanged } = this.props;\n    this.setState({ open: newOpen }, () => {\n      onOpenStateChanged && onOpenStateChanged(newOpen);\n    });\n  }\n\n  render() {\n    const { popupClassName, content, children } = this.props;\n    const newContent = React.cloneElement(content, {\n      className: classnames(styles.Callout_popup, popupClassName),\n      ref: (node) => { this._calloutNode = node; },\n      key: 'Callout#popup',\n    });\n    return <div className={styles.Callout}\n        ref={(node) => { this._node = node; }}>\n      <div className={styles.Callout_trigger}\n          onClick={this._onClick}\n          role=\"button\"\n          tabIndex=\"0\">\n        {children}\n      </div>\n      <CSSTransitionGroup transitionName=\"popup\"\n          transitionEnterTimeout={200}\n          transitionLeaveTimeout={200}>\n        {this.state.open &&\n          <div className={styles.Callout_notch}\n              ref={(node) => { this._notchNode = node; }}\n              key=\"Callout#notch\" /> }\n        {this.state.open && newContent}\n      </CSSTransitionGroup>\n    </div>;\n  }\n}\n\nCallout.defaultProps = {\n  points: ['tr', 'bc'],\n  offset: [65, 25],\n};\n\nCallout.propTypes = {\n  popupClassName: PropTypes.string,\n  children: PropTypes.node,\n  content: PropTypes.node,\n  points: PropTypes.arrayOf((val, key) => {\n    if (is.string(val) && val.length === 2 && key < 2) return true;\n    return new Error('`points` should use the format required by dom-align');\n  }),\n  offset: PropTypes.arrayOf((val, key) => {\n    if (is.number(val) && val.length === 2 && key < 2) return true;\n    return new Error('`offset` should use the format required by dom-align');\n  }),\n  onOpenStateChanged: PropTypes.func,\n};\n\nexport default Callout;\n"]}