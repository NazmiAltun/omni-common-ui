{"version":3,"sources":["components/Callout/index.jsx"],"names":["RESIZE_DEBOUNCE_MS","Callout","state","open","_onClick","bind","_onClickedOutside","_updatePosition","document","body","addEventListener","window","_onResizeHandler","leading","trailing","removeEventListener","_calloutNode","props","points","offset","notchPoints","_notchNode","_node","children","evt","contains","target","setState","popupClassName","content","newContent","cloneElement","className","Callout_popup","ref","node","key","Callout_trigger","Callout_notch","defaultProps","propTypes","string","arrayOf","val","length","Error","number"],"mappings":"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","file":"index.js","sourcesContent":["import styles from './style.postcss';\n\nimport React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport is from 'is_js';\nimport domAlign from 'dom-align';\nimport debounce from 'lodash.debounce';\nimport classnames from 'classnames';\n\nconst RESIZE_DEBOUNCE_MS = 30;\n\nclass Callout extends PureComponent {\n  constructor() {\n    super();\n    this.state = { open: false };\n    this._onClick = this._onClick.bind(this);\n    this._onClickedOutside = this._onClickedOutside.bind(this);\n  }\n\n  componentDidMount() {\n    this._updatePosition();\n    document.body.addEventListener('click', this._onClickedOutside);\n    document.body.addEventListener('touchstart', this._onClickedOutside);\n    window.addEventListener('resize', this._onResizeHandler = debounce(() => {\n      this._updatePosition();\n    }, RESIZE_DEBOUNCE_MS, {\n      leading: true,  // nicer iOS screen rotate\n      trailing: true,\n    }), false);\n  }\n\n  componentDidUpdate() {\n    this._updatePosition();\n  }\n\n  componentWillUnmount() {\n    document.body.removeEventListener('click', this._onClickedOutside);\n    document.body.removeEventListener('touchstart', this._onClickedOutside);\n    window.removeEventListener('resize', this._onResizeHandler);\n  }\n\n  _updatePosition() {\n    if (! this._calloutNode) return;\n    const { points, offset } = this.props;\n    const notchPoints = ['tl', 'bl'];\n    domAlign(this._notchNode, this._node.children[0], {\n      points: notchPoints,\n      offset: [0, 15],\n    });\n    domAlign(this._calloutNode, this._node.children[0], {\n      points, offset });\n  }\n\n  _onClickedOutside(evt) {\n    if ((this._node && this._node.contains(evt.target)) ||\n        (this._calloutNode && this._calloutNode.contains(evt.target))) {\n      return;\n    }\n    this.setState({ open: false });\n  }\n\n  _onClick() {\n    this.setState({ open: ! this.state.open });\n  }\n\n  render() {\n    const { popupClassName, content, children } = this.props;\n    const newContent = React.cloneElement(content, {\n      className: classnames(styles.Callout_popup, popupClassName),\n      ref: (node) => { this._calloutNode = node; },\n      key: 'Callout#popup',\n    });\n    return <div className={styles.Callout}\n        ref={(node) => { this._node = node; }}>\n      <div className={styles.Callout_trigger}\n          onClick={this._onClick}\n          role=\"button\"\n          tabIndex=\"0\">\n        {children}\n      </div>\n      {this.state.open && [\n        <div className={styles.Callout_notch}\n            ref={(node) => { this._notchNode = node; }}\n            key=\"Callout#notch\" />,\n        newContent] }\n    </div>;\n  }\n}\n\nCallout.defaultProps = {\n  points: ['tr', 'bc'],\n  offset: [65, 25],\n};\n\nCallout.propTypes = {\n  popupClassName: PropTypes.string,\n  children: PropTypes.node,\n  content: PropTypes.node,\n  points: PropTypes.arrayOf((val, key) => {\n    if (is.string(val) && val.length === 2 && key < 2) return true;\n    return new Error('`points` should use the format required by dom-align');\n  }),\n  offset: PropTypes.arrayOf((val, key) => {\n    if (is.number(val) && val.length === 2 && key < 2) return true;\n    return new Error('`offset` should use the format required by dom-align');\n  }),\n};\n\nexport default Callout;\n"]}